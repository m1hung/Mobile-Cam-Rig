<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Multi-Cam Control Center</title>
    <style>
        :root {
            /* Modern Dark Theme */
            --bg-color: #000000;
            --surface-color: #1c1c1e;
            --surface-elevated: #2c2c2e;
            --header-bg: rgba(28, 28, 30, 0.85);
            --border-color: #38383a;
            --divider: #2c2c2e;
            --modal-bg: rgba(0, 0, 0, 0.7);
            
            --text-primary: #ffffff;
            --text-secondary: #8e8e93;

            /* Core Accents */
            --primary-color: #0a84ff;
            --danger-color: #ff453a;
            --success-color: #32d74b;
            --warning-color: #ff9f0a;
            --bookmark-color: #bf5af2;
            
            --radius-sm: 10px;
            --radius-md: 16px;
            --radius-lg: 24px;
            
            --shadow-sm: none;
            --shadow-md: none;
        }

        [data-theme="light"] {
            /* Modern Light Theme */
            --bg-color: #f2f2f7;
            --surface-color: #ffffff;
            --surface-elevated: #f2f2f7;
            --header-bg: rgba(255, 255, 255, 0.9);
            --border-color: #e5e5ea;
            --divider: #e5e5ea;
            --modal-bg: rgba(0, 0, 0, 0.3);
            
            --text-primary: #000000;
            --text-secondary: #8a8a8e;

            --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);
            --shadow-md: 0 8px 24px rgba(0,0,0,0.08);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
            padding-bottom: calc(140px + env(safe-area-inset-bottom, 0px)); 
            transition: background-color 0.2s, color 0.2s;
        }

        /* --- Header & Top Navigation --- */
        header {
            position: sticky;
            top: 0;
            background: var(--header-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            padding: calc(12px + env(safe-area-inset-top, 0px)) 20px 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            border-bottom: 1px solid var(--border-color);
        }

        .header-left, .header-right { display: flex; align-items: center; gap: 12px; }
        
        .app-logo { height: 26px; border-radius: 6px; }
        .app-logo.hidden { display: none; }
        
        header h1 { font-size: 17px; font-weight: 700; letter-spacing: -0.5px; }

        .icon-btn {
            background: var(--surface-elevated);
            border: none;
            height: 36px; width: 36px;
            border-radius: 50%;
            font-size: 16px;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            color: var(--text-primary);
        }

        /* --- Minimalist Dashboard --- */
        .dashboard-header {
            padding: 20px 20px 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }

        .metadata-pill {
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            padding: 10px 16px;
            border-radius: 30px;
            font-size: 13px;
            font-weight: 600;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .view-toggle {
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            padding: 10px 16px;
            border-radius: 30px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            color: var(--text-primary);
        }

        /* --- Computer Cards --- */
        .computer-list { display: flex; flex-direction: column; gap: 16px; padding: 10px 20px; }

        .computer-card {
            background-color: var(--surface-color);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            overflow: visible;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border-color);
            position: relative;
        }

        /* Card Header */
        .card-top {
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--divider);
        }

        .card-title-area { display: flex; align-items: center; gap: 10px; }
        
        .status-dot { height: 10px; width: 10px; border-radius: 50%; }
        .dot-ready { background-color: var(--success-color); }
        .dot-rec { background-color: var(--danger-color); box-shadow: 0 0 8px var(--danger-color); }
        .dot-error { background-color: var(--warning-color); }

        .card-title { font-size: 16px; font-weight: 700; letter-spacing: -0.3px; }

        /* Camera Feed */
        .camera-feed {
            width: 100%; height: 160px;
            background: var(--cam-feed-bg);
            display: flex; align-items: center; justify-content: center;
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 500;
        }

        /* Card Footer - Primary Controls */
        .card-bottom {
            padding: 16px 16px 12px 16px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .drive-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .drive-text { font-size: 11px; font-weight: 600; color: var(--text-secondary); display: flex; justify-content: space-between; }
        .progress-bar { width: 100%; height: 4px; background-color: var(--surface-elevated); border-radius: 2px; overflow: hidden; }
        .progress-fill { height: 100%; background-color: var(--primary-color); }
        .progress-fill.full { background-color: var(--danger-color); }

        .btn-card-rec {
            background-color: var(--surface-elevated);
            color: var(--success-color);
            border: none;
            height: 40px; width: 40px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 16px;
            cursor: pointer;
        }
        .btn-card-rec.is-recording {
            background-color: rgba(255, 69, 58, 0.15);
            color: var(--danger-color);
        }

        /* Card Footer - Secondary Actions (Always Visible) */
        .card-actions {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            padding: 0 16px 16px 16px;
        }

        .action-btn {
            background-color: var(--surface-elevated);
            color: var(--text-primary);
            border: none;
            padding: 10px;
            border-radius: var(--radius-sm);
            font-size: 12px; 
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        .action-btn:active { opacity: 0.7; }
        .action-btn:disabled { opacity: 0.4; cursor: not-allowed; }
        .action-btn.warning { color: var(--warning-color); }
        .action-btn.danger { color: var(--danger-color); }

        /* Diagnostics Banner */
        .diagnostics {
            background-color: rgba(255, 159, 10, 0.1);
            color: var(--warning-color);
            padding: 10px 16px;
            font-size: 12px;
            font-weight: 600;
            border-bottom: 1px solid var(--border-color);
            display: none;
        }
        .has-error .diagnostics { display: block; }

        /* Add Rig FAB/Button */
        .btn-add-rig-dashed {
            background: transparent;
            border: 2px dashed var(--border-color);
            color: var(--text-secondary);
            padding: 20px;
            border-radius: var(--radius-lg);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 8px;
        }

        /* --- Minimal Card Styles --- */
        .minimal-card {
            background-color: var(--surface-color); border-radius: var(--radius-md); padding: 16px;
            display: flex; flex-direction: column; gap: 12px;
            border: 1px solid var(--border-color); box-shadow: var(--shadow-sm);
        }
        .minimal-top {
            display: flex; justify-content: space-between; align-items: center;
        }
        .minimal-left { display: flex; align-items: center; gap: 12px; }
        .minimal-left h2 { font-size: 15px; font-weight: 600; margin: 0; }
        .minimal-right { display: flex; align-items: center; gap: 16px; }
        .minimal-drive { width: 60px; }
        
        .minimal-actions {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            border-top: 1px solid var(--divider);
            padding-top: 12px;
        }

        /* --- Modals --- */
        .modal-overlay {
            position: fixed; inset: 0; background-color: var(--modal-bg); backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px);
            z-index: 1000; display: none; justify-content: center; align-items: flex-end; padding: 20px;
        }
        .modal-overlay.active { display: flex; }
        
        .modal-content {
            background-color: var(--surface-color); padding: 24px; border-radius: var(--radius-lg);
            width: 100%; max-width: 400px; display: flex; flex-direction: column; gap: 16px;
            box-shadow: var(--shadow-md); margin-bottom: env(safe-area-inset-bottom, 20px);
            max-height: 85vh; overflow-y: auto;
        }
        
        .modal-content h3 { font-size: 18px; font-weight: 700; margin-bottom: 4px; }
        .modal-content label { font-size: 12px; font-weight: 600; color: var(--text-secondary); margin-bottom: -10px; }
        
        .modal-content select, .modal-content input, .modal-content textarea {
            width: 100%; padding: 14px; background-color: var(--surface-elevated); border: 1px solid var(--border-color);
            color: var(--text-primary); border-radius: var(--radius-md); font-size: 14px; outline: none; appearance: none;
        }
        
        input::-webkit-calendar-picker-indicator { color: var(--text-secondary); opacity: 1; cursor: pointer; }

        .modal-content textarea { resize: vertical; min-height: 80px; font-family: inherit; }

        .operator-inputs { display: flex; gap: 8px; margin-bottom: 4px; }
        .operator-inputs input, .operator-inputs select { flex: 1; min-width: 0; }
        .btn-add-op { background-color: var(--element-bg); border: 1px solid var(--element-border); color: var(--text-primary); padding: 10px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px;}

        .operator-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-top: -5px; }
        .op-tag {
            background-color: rgba(10, 132, 255, 0.15); color: var(--primary-color); border: 1px solid var(--primary-color);
            padding: 6px 12px; border-radius: 14px; font-size: 12px; display: flex; align-items: center; gap: 8px;
        }
        .op-tag span { cursor: pointer; font-weight: bold; font-size: 16px; line-height: 1; }
        
        .modal-actions { display: flex; gap: 10px; margin-top: 8px; }
        .modal-actions button { flex: 1; padding: 14px; border-radius: var(--radius-md); font-weight: 600; cursor: pointer; border: none;}
        .btn-cancel { background-color: var(--surface-elevated); color: var(--text-primary); }
        .btn-primary { background-color: var(--primary-color); color: white; }

        /* --- Bottom Action Bar --- */
        .bottom-action-bar {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background: var(--header-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-top: 1px solid var(--border-color);
            padding: 12px 20px calc(16px + env(safe-area-inset-bottom, 0px)) 20px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            z-index: 100;
        }

        .btn-record-all {
            height: 56px; width: 100%; 
            border-radius: var(--radius-lg);
            background-color: var(--text-primary); 
            color: var(--bg-color);
            border: none; cursor: pointer; font-weight: 700; font-size: 16px;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        
        .btn-record-all.recording {
            width: 130px; 
            border-radius: 30px; 
            background-color: var(--danger-color);
            color: white;
            margin-left: 12px;
        }

        .bookmark-container {
            display: none; 
            align-items: center; gap: 8px; overflow-x: auto; scrollbar-width: none; white-space: nowrap;
            width: calc(100% - 142px); 
        }
        .bookmark-container::-webkit-scrollbar { display: none; }
        .bookmark-container.show { display: flex; }

        .btn-bookmark-preset {
            background-color: var(--surface-elevated);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 0 16px; height: 44px; border-radius: var(--radius-md);
            font-weight: 600; font-size: 13px; cursor: pointer; flex-shrink: 0; display: flex; align-items: center; gap: 6px;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: calc(100px + env(safe-area-inset-bottom, 0px));
            left: 50%; transform: translateX(-50%);
            background-color: var(--text-primary);
            color: var(--bg-color);
            padding: 12px 24px; border-radius: 30px; font-size: 14px; font-weight: 700;
            opacity: 0; pointer-events: none; transition: opacity 0.2s ease; z-index: 1000;
            box-shadow: var(--shadow-md);
        }
        .toast.show { opacity: 1; }

    </style>
</head>
<body>

    <header>
        <div class="header-left">
            <img id="appLogo" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='28' height='28' viewBox='0 0 100 100'><rect width='100' height='100' fill='%230a84ff' rx='10'/><circle cx='50' cy='50' r='25' fill='white'/></svg>" class="app-logo" alt="Production Logo">
            <h1>Session Control</h1>
        </div>
        <div class="header-right">
            <button class="icon-btn" onclick="openTicketModal()" title="Report Issue">üé´</button>
            <button class="icon-btn" onclick="toggleLogo()" title="Toggle Logo">üñºÔ∏è</button>
            <button class="icon-btn" id="themeToggleBtn" onclick="toggleTheme()">‚òÄÔ∏è</button>
        </div>
    </header>

    <div class="dashboard-header">
        <button class="metadata-pill" onclick="openMetadataModal()" id="metaSummaryBtn">
            üè∑Ô∏è Schema: None
        </button>
        <button class="view-toggle" id="viewToggleBtn" onclick="toggleView()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle;"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="9" y1="21" x2="9" y2="9"></line></svg>
        </button>
    </div>

    <div class="computer-list">
        <div id="computerList">
            </div>
        <button class="btn-add-rig-dashed" onclick="openAddRigModal()">+ Add New Rig</button>
    </div>

    <div class="bottom-action-bar" id="bottomActionBar">
        <div class="bookmark-container" id="bookmarkContainer">
            <button class="btn-bookmark-preset" onclick="dropBookmark('‚≠ê Good Take')">‚≠ê Good Take</button>
            <button class="btn-bookmark-preset" onclick="dropBookmark('‚ùå False Start')">‚ùå False</button>
            <button class="btn-bookmark-preset" onclick="dropBookmark('üí• Action Mark')">üí• Action</button>
        </div>
        <button class="btn-record-all" id="globalRecordBtn" onclick="toggleGlobalRecord()">
            <span id="recordIcon">‚è∫</span> <span id="recordText">Start Session</span>
        </button>
    </div>

    <div id="toast" class="toast">Action Successful!</div>

    <div class="modal-overlay" id="metadataModal">
        <div class="modal-content">
            <h3>Session Metadata</h3>
            
            <label>Quick Preset</label>
            <select id="presetSelect" onchange="applyPresetFromDropdown(this.value)">
                <option value="none">Custom / None</option>
                <option value="1">Studio Setup</option>
                <option value="2">Field Action</option>
                <option value="3">Night Drone</option>
                <option value="4">Interview B-Cam</option>
            </select>

            <label>Location</label>
            <select id="metaLoc">
                <option value="Studio A">Studio A</option>
                <option value="Ext. City">Ext. City</option>
                <option value="Rooftop">Rooftop</option>
            </select>
            
            <label>Add Crew Member</label>
            <div class="operator-inputs">
                <input type="text" id="rosterInput" list="rosterList" placeholder="Type or select name...">
                <datalist id="rosterList"></datalist>
                
                <select id="roleSelect" style="flex: 0.6;">
                    <option value="Operator">Operator</option>
                    <option value="1st AC">1st AC</option>
                    <option value="DIT">DIT</option>
                </select>
            </div>
            <button class="btn-add-op" onclick="addOperator()">+ Add to Session</button>
            
            <div class="operator-tags" id="selectedOperators"></div>

            <label>Equipment Type</label>
            <select id="metaEq">
                <option value="ARRI Alexa">ARRI Alexa</option>
                <option value="RED Komodo">RED Komodo</option>
                <option value="Sony FX6">Sony FX6</option>
            </select>

            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeMetadataModal()">Cancel</button>
                <button class="btn-primary" onclick="saveCustomMetadata()">Apply</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="ticketModal">
        <div class="modal-content">
            <h3>Report Issue</h3>
            <label>Issue Type</label>
            <select id="ticketType">
                <option value="Faulty Equipment">Faulty Equipment</option>
                <option value="Connectivity">Connectivity Issue</option>
                <option value="Hardware Damage">Hardware Damage</option>
                <option value="Software Glitch">Software Glitch</option>
                <option value="Other">Other</option>
            </select>
            
            <label>Affected Rig</label>
            <select id="ticketRigSelect"></select>
            
            <label>Description</label>
            <textarea id="ticketDescription" placeholder="Details..."></textarea>
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeTicketModal()">Cancel</button>
                <button class="btn-primary" onclick="submitTicket()" style="background-color: var(--warning-color); color:#000;">Submit</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="addRigModal">
        <div class="modal-content">
            <h3>Add Camera Rig</h3>
            <label>Rig Name</label>
            <input type="text" id="rigNameInput" list="rigOptionsList" placeholder="Type name or select preset...">
            <datalist id="rigOptionsList">
                <option value="Cam-Rig Alpha">
                <option value="Cam-Rig Beta">
                <option value="Cam-Rig Gamma">
                <option value="Drone Cam 1">
                <option value="Steadicam 1">
                <option value="Crash Cam">
            </datalist>

            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeAddRigModal()">Cancel</button>
                <button class="btn-primary" onclick="confirmAddRig()">Add Rig</button>
            </div>
        </div>
    </div>

    <script>
        // Roster Data for Autofill
        const employeeRoster = [
            "Sarah Jenkins",
            "Marcus Thorne",
            "David Chen",
            "Elena Rostova",
            "James Miller",
            "Alex Mercer",
            "Unknown / TBD"
        ];

        // Data Models
        const schemas = [
            { id: '1', label: "Studio Setup", tags: { loc: "Studio A", eq: "ARRI Alexa" } },
            { id: '2', label: "Field Action", tags: { loc: "Ext. City", eq: "RED Komodo" } },
            { id: '3', label: "Night Drone",  tags: { loc: "Rooftop", eq: "DJI Inspire" } },
            { id: '4', label: "Interview B",  tags: { loc: "Office 2", eq: "Sony FX6" } }
        ];

        // State
        let isGlobalRecording = false;
        let isDetailedView = true;
        let isLogoVisible = true;
        let activeSchemaId = null;
        let currentMetadataObj = null; 
        let computerIdCounter = 3;
        let currentTheme = 'dark';
        
        let tempOperators = [];

        let computers = [
            { id: 1, name: "Cam-Rig Alpha", isMounted: true, driveUsage: 95, isRecording: false, errors: ["Drive Full"] },
            { id: 2, name: "Cam-Rig Beta", isMounted: false, driveUsage: 42, isRecording: false, errors: ["Unmounted"] },
        ];

        // UI State Actions
        function toggleTheme() {
            currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', currentTheme);
            document.getElementById('themeToggleBtn').innerText = currentTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

        function toggleLogo() {
            isLogoVisible = !isLogoVisible;
            const logo = document.getElementById('appLogo');
            isLogoVisible ? logo.classList.remove('hidden') : logo.classList.add('hidden');
        }

        function showToast(message, bgColor = "var(--text-primary)", textColor = "var(--bg-color)") {
            const toast = document.getElementById('toast');
            toast.innerText = message;
            toast.style.backgroundColor = bgColor;
            toast.style.color = textColor;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        function dropBookmark(tagName) {
            showToast(`üîñ ${tagName}`); 
        }

        // Ticketing
        function openTicketModal() { 
            const rigSelect = document.getElementById('ticketRigSelect');
            rigSelect.innerHTML = '<option value="General">General / All Rigs</option>'; 
            computers.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c.name;
                opt.innerText = c.name;
                rigSelect.appendChild(opt);
            });
            document.getElementById('ticketDescription').value = '';
            document.getElementById('ticketModal').classList.add('active'); 
        }
        function closeTicketModal() { document.getElementById('ticketModal').classList.remove('active'); }
        function submitTicket() { closeTicketModal(); showToast('üéüÔ∏è Ticket Submitted', 'var(--warning-color)', '#000'); }

        // Render Logic
        function render() {
            renderComputers();
            updateDashboardHeader();
            populateRosterDatalist();
        }

        function populateRosterDatalist() {
            const list = document.getElementById('rosterList');
            if (list.children.length === 0) {
                employeeRoster.forEach(emp => {
                    const opt = document.createElement('option');
                    opt.value = emp;
                    list.appendChild(opt);
                });
            }
        }

        function updateDashboardHeader() {
            const btn = document.getElementById('metaSummaryBtn');
            if (activeSchemaId) {
                const s = schemas.find(x => x.id === activeSchemaId);
                btn.innerText = `üè∑Ô∏è Schema: ${s.label}`;
            } else if (currentMetadataObj) {
                btn.innerText = `üè∑Ô∏è Custom Metadata`;
            } else {
                btn.innerText = `üè∑Ô∏è Schema: None`;
            }
        }

        function renderComputers() {
            const list = document.getElementById('computerList');
            list.innerHTML = '';

            computers.forEach(comp => {
                const isFull = comp.driveUsage >= 90;
                let statusClass = "dot-ready";
                
                if (comp.errors.length > 0) statusClass = "dot-error";
                else if (comp.isRecording) statusClass = "dot-rec";

                const card = document.createElement('div');

                if (isDetailedView) {
                    card.className = `computer-card ${comp.errors.length > 0 ? 'has-error' : ''}`;
                    card.innerHTML = `
                        <div class="card-top">
                            <div class="card-title-area">
                                <div class="status-dot ${statusClass}"></div>
                                <div class="card-title">${comp.name}</div>
                            </div>
                        </div>
                        
                        <div class="diagnostics">${comp.errors.join(', ')}</div>
                        
                        <div class="camera-feed">Live Feed Offline</div>
                        
                        <div class="card-bottom">
                            <div class="drive-info">
                                <div class="drive-text"><span>Storage</span><span>${comp.driveUsage}%</span></div>
                                <div class="progress-bar"><div class="progress-fill ${isFull ? 'full' : ''}" style="width: ${comp.driveUsage}%"></div></div>
                            </div>
                            <button class="btn-card-rec ${comp.isRecording ? 'is-recording' : ''}" onclick="toggleSingleRecord(${comp.id})" ${comp.errors.length > 0 ? 'disabled' : ''}>
                                ${comp.isRecording ? '‚èπ' : '‚è∫'}
                            </button>
                        </div>

                        <div class="card-actions">
                            <button class="action-btn ${comp.isMounted ? '' : 'warning'}" onclick="toggleMount(${comp.id})">${comp.isMounted ? '‚èè Unmount' : '‚¨á Mount'}</button>
                            <button class="action-btn warning" onclick="eraseDrive(${comp.id})" ${!comp.isMounted || comp.isRecording ? 'disabled' : ''}>Erase</button>
                            <button class="action-btn danger" onclick="removeComputer(${comp.id})">Remove</button>
                        </div>
                    `;
                } else {
                    card.className = `minimal-card ${comp.errors.length > 0 ? 'has-error' : ''}`;
                    card.innerHTML = `
                        <div class="minimal-top">
                            <div class="minimal-left">
                                <div class="status-dot ${statusClass}"></div>
                                <h2>${comp.name}</h2>
                            </div>
                            <div class="minimal-right">
                                <div class="minimal-drive">
                                    <div class="drive-text" style="font-size:10px; color:var(--text-secondary); margin-bottom:4px;">${comp.driveUsage}%</div>
                                    <div class="progress-bar"><div class="progress-fill ${isFull ? 'full' : ''}" style="width: ${comp.driveUsage}%"></div></div>
                                </div>
                                <button class="btn-card-rec ${comp.isRecording ? 'is-recording' : ''}" style="height:32px; width:32px; font-size:12px;" onclick="toggleSingleRecord(${comp.id})" ${comp.errors.length > 0 ? 'disabled' : ''}>
                                    ${comp.isRecording ? '‚èπ' : '‚è∫'}
                                </button>
                            </div>
                        </div>
                        
                        <div class="minimal-actions">
                            <button class="action-btn ${comp.isMounted ? '' : 'warning'}" onclick="toggleMount(${comp.id})">${comp.isMounted ? '‚èè Unmount' : '‚¨á Mount'}</button>
                            <button class="action-btn warning" onclick="eraseDrive(${comp.id})" ${!comp.isMounted || comp.isRecording ? 'disabled' : ''}>Erase</button>
                            <button class="action-btn danger" onclick="removeComputer(${comp.id})">Remove</button>
                        </div>
                    `;
                }
                list.appendChild(card);
            });

            // Master Record Button Sync
            const recBtn = document.getElementById('globalRecordBtn');
            const bookmarkContainer = document.getElementById('bookmarkContainer');

            if (isGlobalRecording) {
                recBtn.classList.add('recording');
                recBtn.innerHTML = '<span>‚èπ</span> <span>STOP</span>';
                bookmarkContainer.classList.add('show');
            } else {
                recBtn.classList.remove('recording');
                recBtn.innerHTML = '<span>‚è∫</span> <span>Start Session</span>';
                bookmarkContainer.classList.remove('show');
            }
        }

        // Card Actions
        function toggleSingleRecord(id) {
            const comp = computers.find(c => c.id === id);
            if (!comp || comp.errors.length > 0) return;
            comp.isRecording = !comp.isRecording;
            checkGlobalRecordingValidity();
            render();
        }

        function toggleMount(id) {
            const comp = computers.find(c => c.id === id);
            comp.isMounted = !comp.isMounted;
            if (!comp.isMounted) {
                comp.errors = ["Unmounted"];
                comp.isRecording = false; 
            } else {
                comp.errors = [];
                if (comp.driveUsage >= 90) comp.errors.push("Drive Full");
            }
            checkGlobalRecordingValidity();
            render();
        }

        function eraseDrive(id) {
            const comp = computers.find(c => c.id === id);
            if (!comp || !comp.isMounted || comp.isRecording) return;
            if (confirm(`Erase ${comp.name}?`)) {
                comp.driveUsage = 0; 
                comp.errors = [];
                render();
            }
        }

        function removeComputer(id) {
            computers = computers.filter(c => c.id !== id);
            checkGlobalRecordingValidity();
            render();
        }

        // Global Actions
        function toggleView() { isDetailedView = !isDetailedView; render(); }

        function toggleGlobalRecord() {
            isGlobalRecording = !isGlobalRecording;
            computers.forEach(comp => {
                if (isGlobalRecording && comp.errors.length === 0) comp.isRecording = true;
                else comp.isRecording = false;
            });
            render();
        }

        function checkGlobalRecordingValidity() {
            isGlobalRecording = computers.some(c => c.isRecording);
        }

        // Metadata 
        function openMetadataModal() { 
            renderModalOperators();
            document.getElementById('metadataModal').classList.add('active'); 
        }
        
        function closeMetadataModal() { document.getElementById('metadataModal').classList.remove('active'); }
        
        function applyPresetFromDropdown(val) {
            if(val === 'none') { activeSchemaId = null; return; }
            activeSchemaId = val;
            const s = schemas.find(x => x.id === val);
            document.getElementById('metaLoc').value = s.tags.loc;
            document.getElementById('metaEq').value = s.tags.eq;
        }

        function addOperator() {
            const name = document.getElementById('rosterInput').value.trim();
            const role = document.getElementById('roleSelect').value;
            if (!name) return;
            
            const str = `${name} (${role})`;
            if (!tempOperators.includes(str)) {
                tempOperators.push(str);
                document.getElementById('rosterInput').value = ''; 
                renderModalOperators();
            }
        }

        function removeOperator(index) {
            tempOperators.splice(index, 1);
            renderModalOperators();
        }

        function renderModalOperators() {
            const container = document.getElementById('selectedOperators');
            container.innerHTML = '';
            tempOperators.forEach((op, index) => {
                const tag = document.createElement('div');
                tag.className = 'op-tag';
                tag.innerHTML = `${op} <span onclick="removeOperator(${index})">&times;</span>`;
                container.appendChild(tag);
            });
        }

        function saveCustomMetadata() {
            currentMetadataObj = {
                loc: document.getElementById('metaLoc').value,
                eq: document.getElementById('metaEq').value,
                ops: [...tempOperators]
            };
            const presetVal = document.getElementById('presetSelect').value;
            if(presetVal === 'none') activeSchemaId = null;
            
            closeMetadataModal();
            render();
        }

        // Add Rig using Autofill Input
        function openAddRigModal() { 
            document.getElementById('rigNameInput').value = ''; 
            document.getElementById('addRigModal').classList.add('active'); 
        }
        
        function closeAddRigModal() { document.getElementById('addRigModal').classList.remove('active'); }
        
        function confirmAddRig() {
            const inputVal = document.getElementById('rigNameInput').value.trim();
            const finalName = inputVal !== '' ? inputVal : `Camera Rig ${computerIdCounter + 1}`;

            computers.push({
                id: ++computerIdCounter, 
                name: finalName,
                isMounted: true, 
                driveUsage: Math.floor(Math.random() * 80), 
                isRecording: isGlobalRecording, 
                errors: []
            });
            closeAddRigModal();
            render();
        }

        render();
    </script>
</body>
</html>
