<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Cam Control Center</title>
    <style>
        :root {
            /* Core Theme Colors - Dark (Default) */
            --bg-color: #000000;
            --surface-color: #1c1c1e;
            --header-bg: rgba(28, 28, 30, 0.85);
            --border-color: #333333;
            --element-bg: #2c2c2e;
            --element-border: #3a3a3c;
            --cam-feed-bg: linear-gradient(135deg, #2c2c2e, #1a1a1c);
            --modal-bg: rgba(0, 0, 0, 0.8);
            
            /* Text Colors */
            --text-primary: #ffffff;
            --text-secondary: #8e8e93;

            /* Accent Colors (Consistent across modes) */
            --primary-color: #0a84ff;
            --danger-color: #ff453a;
            --success-color: #32d74b;
            --warning-color: #ff9f0a;
            --paused-color: #ffd60a;
            
            --border-radius: 16px;
        }

        [data-theme="light"] {
            /* Core Theme Colors - Light */
            --bg-color: #f2f2f7;
            --surface-color: #ffffff;
            --header-bg: rgba(255, 255, 255, 0.85);
            --border-color: #e5e5ea;
            --element-bg: #f2f2f7;
            --element-border: #d1d1d6;
            --cam-feed-bg: linear-gradient(135deg, #e5e5ea, #d1d1d6);
            --modal-bg: rgba(0, 0, 0, 0.4);
            
            /* Text Colors */
            --text-primary: #000000;
            --text-secondary: #6c6c70;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
            padding-bottom: 40px;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Header */
        header {
            position: sticky;
            top: 0;
            background: var(--header-bg);
            backdrop-filter: blur(10px);
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.3s, border-color 0.3s;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .app-logo {
            height: 28px;
            width: auto;
            border-radius: 6px;
            transition: all 0.3s ease;
            display: block;
        }

        .app-logo.hidden {
            display: none;
        }

        header h1 {
            font-size: 18px;
            font-weight: 600;
            white-space: nowrap;
        }

        .theme-toggle {
            background: transparent;
            border: none;
            font-size: 18px;
            cursor: pointer;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
        }

        .btn-record-all {
            background-color: var(--success-color);
            color: #000;
            border: none;
            padding: 10px 14px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }
        
        .btn-record-all.recording {
            background-color: var(--danger-color);
            color: white;
            animation: pulse-red 1.5s infinite;
        }

        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(255, 69, 58, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 69, 58, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 69, 58, 0); }
        }

        /* Global Controls Panel */
        .global-controls {
            padding: 15px 20px;
            background-color: var(--surface-color);
            margin: 15px;
            border-radius: var(--border-radius);
            display: flex;
            flex-direction: column;
            gap: 15px;
            transition: background-color 0.3s;
        }

        .schema-header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .schema-header {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .schema-actions {
            display: flex;
            gap: 8px;
        }

        /* CUSTOM BUTTONS */
        .btn-edit-schema, .btn-toggle-logo {
            background-color: var(--element-bg);
            border: 1px solid var(--element-border);
            padding: 8px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-edit-schema { color: var(--primary-color); }
        .btn-toggle-logo { color: var(--text-secondary); }

        .btn-edit-schema:active, .btn-toggle-logo:active { opacity: 0.8; }

        /* Custom Dropdown */
        .dropdown { position: relative; width: 100%; }

        .dropdown-toggle {
            width: 100%;
            background-color: var(--element-bg);
            border: 1px solid var(--element-border);
            color: var(--text-primary);
            padding: 14px 15px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dropdown-toggle.has-selection {
            background-color: rgba(10, 132, 255, 0.1);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0; right: 0;
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-top: 6px;
            z-index: 50;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .dropdown-menu.active { display: block; }

        .dropdown-item {
            padding: 14px 15px;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .dropdown-item:last-child { border-bottom: none; }
        .dropdown-item:active { background-color: var(--element-bg); }
        
        .dropdown-item.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            font-weight: 600;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s, opacity 0.2s;
        }

        button:active { opacity: 0.8; }
        button:disabled { opacity: 0.4; cursor: not-allowed; }

        .control-row {
            display: flex;
            gap: 10px;
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
        }

        .btn-add { background-color: var(--element-bg); color: var(--success-color); flex: 1; border: 1px solid transparent; }
        .btn-toggle-view { background-color: var(--element-bg); color: var(--primary-color); flex: 1; border: 1px solid transparent;}

        /* Computer List */
        .computer-list { display: flex; flex-direction: column; gap: 15px; padding: 0 15px; }

        /* Detailed Card Styles */
        .computer-card {
            background-color: var(--surface-color);
            border-radius: var(--border-radius);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s;
        }

        .camera-feed {
            width: 100%; height: 180px;
            background: var(--cam-feed-bg);
            position: relative;
            display: flex; align-items: center; justify-content: center;
            color: var(--text-secondary);
            font-size: 12px;
            transition: background 0.3s;
        }

        .status-badge {
            padding: 4px 8px; border-radius: 12px;
            font-size: 10px; font-weight: 700; text-transform: uppercase; text-align: center;
        }
        
        .camera-feed .status-badge { position: absolute; top: 10px; left: 10px; }

        .status-rec { background: var(--danger-color); color: white; }
        .status-ready { background: var(--success-color); color: #000; }
        .status-error { background: var(--warning-color); color: black; }

        .card-details { padding: 15px; display: flex; flex-direction: column; gap: 15px; }
        .card-header h2 { font-size: 16px; margin-bottom: 4px; }

        .metadata-tags {
            font-size: 11px; color: var(--text-secondary); background: var(--element-bg);
            padding: 6px 10px; border-radius: 6px; display: inline-block; line-height: 1.4;
        }

        .metadata-tags strong { color: var(--primary-color); }

        /* Drive Status */
        .drive-status { display: flex; flex-direction: column; gap: 5px; }
        .drive-header { display: flex; justify-content: space-between; font-size: 12px; color: var(--text-secondary); }
        .progress-bar { width: 100%; height: 6px; background-color: var(--element-bg); border-radius: 3px; overflow: hidden; }
        .progress-fill { height: 100%; background-color: var(--primary-color); transition: width 0.3s ease; }
        .progress-fill.full { background-color: var(--danger-color); }

        /* Actions */
        .card-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        
        .btn-record-single { background-color: transparent; border: 1px solid var(--success-color); color: var(--success-color); grid-column: span 2; }
        .btn-record-single.is-recording { background-color: var(--danger-color); border-color: var(--danger-color); color: white; }
        
        .btn-mount { background-color: var(--element-bg); border: 1px solid transparent; color: var(--text-primary); }
        .btn-mount.mounted { background-color: transparent; border-color: var(--warning-color); color: var(--warning-color); }
        
        .btn-erase { background-color: transparent; border: 1px solid var(--warning-color); color: var(--warning-color); }
        .btn-remove { background-color: transparent; border: 1px solid var(--danger-color); color: var(--danger-color); grid-column: span 2; }

        /* Diagnostics */
        .diagnostics {
            background-color: rgba(255, 69, 58, 0.1); border-left: 3px solid var(--danger-color);
            padding: 10px; border-radius: 4px; font-size: 12px; color: #ff6961; display: none;
        }
        .has-error .diagnostics { display: block; }

        /* Minimal Card Styles */
        .minimal-card {
            background-color: var(--surface-color); border-radius: 12px; padding: 12px 15px;
            display: flex; flex-direction: column; gap: 8px; border-left: 4px solid transparent;
            transition: background-color 0.3s;
        }
        .minimal-card.has-error { border-left-color: var(--warning-color); }
        .minimal-card.is-recording { border-left-color: var(--danger-color); }
        .minimal-main { display: flex; justify-content: space-between; align-items: center; }
        .minimal-left { display: flex; align-items: center; gap: 12px; }
        .minimal-left h2 { font-size: 15px; margin: 0; }
        .minimal-right { display: flex; flex-direction: column; align-items: flex-end; gap: 6px; width: 80px; }
        .minimal-drive-text { font-size: 11px; color: var(--text-secondary); }
        .minimal-card .progress-bar { width: 100%; height: 4px; }
        .minimal-diagnostics {
            display: block; padding: 8px; margin-top: 4px; background-color: rgba(255, 159, 10, 0.1); 
            border-left-color: var(--warning-color); color: #ffb340;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed; inset: 0; background-color: var(--modal-bg); backdrop-filter: blur(5px);
            z-index: 1000; display: none; justify-content: center; align-items: center; padding: 20px;
            transition: background-color 0.3s;
        }
        .modal-overlay.active { display: flex; }
        
        .modal-content {
            background-color: var(--surface-color); padding: 25px; border-radius: var(--border-radius);
            width: 100%; max-width: 350px; display: flex; flex-direction: column; gap: 15px;
            border: 1px solid var(--border-color);
        }
        
        .modal-content h3 { font-size: 18px; text-align: center; margin-bottom: 5px; }
        .modal-content label { font-size: 12px; color: var(--text-secondary); margin-bottom: -10px; }
        
        .modal-content select, .modal-content input {
            width: 100%; padding: 12px; background-color: var(--element-bg); border: 1px solid var(--element-border);
            color: var(--text-primary); border-radius: 8px; font-size: 14px; outline: none; appearance: none;
        }

        /* Operator Multi-Select Styles */
        .operator-inputs { display: flex; gap: 8px; margin-bottom: 4px; }
        .operator-inputs select { flex: 1; min-width: 0; }
        
        .btn-add-op { background-color: var(--element-bg); border: 1px solid var(--element-border); color: var(--text-primary); padding: 10px; }

        .operator-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-top: -5px; }
        .op-tag {
            background-color: rgba(10, 132, 255, 0.15); color: var(--primary-color); border: 1px solid var(--primary-color);
            padding: 4px 10px; border-radius: 12px; font-size: 11px; display: flex; align-items: center; gap: 6px;
        }
        .op-tag span { cursor: pointer; font-weight: bold; font-size: 14px; line-height: 1; }
        
        .modal-actions { display: flex; gap: 10px; margin-top: 10px; }
        .modal-actions button { flex: 1; }
        .btn-cancel { background-color: transparent; border: 1px solid var(--element-border); color: var(--text-secondary); }

    </style>
</head>
<body>

    <header>
        <div class="header-left">
            <img id="appLogo" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='28' height='28' viewBox='0 0 100 100'><rect width='100' height='100' fill='%230a84ff' rx='22'/><circle cx='50' cy='50' r='25' fill='white'/></svg>" class="app-logo" alt="Production Logo">
            <h1>Session Control</h1>
            <button class="theme-toggle" id="themeToggleBtn" onclick="toggleTheme()" title="Toggle Light/Dark Mode">‚òÄÔ∏è</button>
        </div>
        <button class="btn-record-all" id="globalRecordBtn" onclick="toggleGlobalRecord()">
            <span id="recordIcon">‚è∫</span> <span id="recordText">REC ALL</span>
        </button>
    </header>

    <div class="global-controls">
        <div class="schema-header-container">
            <div class="schema-header">Apply Metadata Schema</div>
            <div class="schema-actions">
                <button class="btn-toggle-logo" onclick="toggleLogo()">üñºÔ∏è Toggle Logo</button>
                <button class="btn-edit-schema" onclick="openMetadataModal()">‚öôÔ∏è Custom Edit</button>
            </div>
        </div>
        
        <div class="dropdown">
            <button class="dropdown-toggle" id="schemaDropdownBtn" onclick="toggleSchemaDropdown()">
                Select Preset Schema <span>‚ñº</span>
            </button>
            <div class="dropdown-menu" id="schemaDropdownMenu">
                </div>
        </div>

        <div class="control-row">
            <button class="btn-add" onclick="openAddRigModal()">+ Add Rig</button>
            <button class="btn-toggle-view" id="viewToggleBtn" onclick="toggleView()">üì∏ Detailed View</button>
        </div>
    </div>

    <div class="computer-list" id="computerList">
        </div>

    <div class="modal-overlay" id="metadataModal">
        <div class="modal-content">
            <h3>Edit Schema Tags</h3>
            
            <label>Location</label>
            <select id="metaLoc">
                <option value="Studio A">Studio A</option>
                <option value="Studio B">Studio B</option>
                <option value="Ext. City">Ext. City</option>
                <option value="Rooftop">Rooftop</option>
                <option value="Office 2">Office 2</option>
            </select>

            <label>Crew Roster & Assinged Role</label>
            <div class="operator-inputs">
                <select id="rosterSelect">
                    </select>
                <select id="roleSelect">
                    </select>
            </div>
            <button class="btn-add-op" onclick="addOperator()">+ Add Crew Member</button>
            
            <div class="operator-tags" id="selectedOperators">
                </div>

            <label>Equipment Type</label>
            <select id="metaEq">
                <option value="ARRI Alexa">ARRI Alexa</option>
                <option value="RED Komodo">RED Komodo</option>
                <option value="DJI Inspire">DJI Inspire</option>
                <option value="Sony FX6">Sony FX6</option>
                <option value="Crash Cam">Crash Cam</option>
            </select>

            <label>Shift</label>
            <select id="metaShift">
                <option value="Morning">Morning</option>
                <option value="Afternoon">Afternoon</option>
                <option value="Night">Night</option>
                <option value="Swing">Swing</option>
            </select>

            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeMetadataModal()">Cancel</button>
                <button onclick="saveCustomMetadata()">Apply to Rigs</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="addRigModal">
        <div class="modal-content">
            <h3>Add Camera Rig</h3>
            
            <label>Select from Roster</label>
            <select id="rigSelect">
                <option value="Cam-Rig Alpha">Cam-Rig Alpha</option>
                <option value="Cam-Rig Beta">Cam-Rig Beta</option>
                <option value="Cam-Rig Gamma">Cam-Rig Gamma</option>
                <option value="Drone Cam 1">Drone Cam 1</option>
                <option value="Crane Cam">Crane Cam</option>
                <option value="Ronin Steadicam">Ronin Steadicam</option>
            </select>

            <label>Or type a Custom Name</label>
            <input type="text" id="customRigName" placeholder="e.g. Crash Cam 2">

            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeAddRigModal()">Cancel</button>
                <button onclick="confirmAddRig()">Add Rig</button>
            </div>
        </div>
    </div>

    <script>
        // Roster Data
        const employeeRoster = [
            "Sarah Jenkins",
            "Marcus Thorne",
            "David Chen",
            "Elena Rostova",
            "James Miller",
            "Unknown / TBD"
        ];

        const defaultRoles = ["Operator", "1st AC", "2nd AC", "DIT", "Utility"];

        // Data Models
        const schemas = [
            { 
                id: 1, label: "Studio Setup",   
                tags: { loc: "Studio A", ops: ["Sarah Jenkins (A-Cam)", "Elena Rostova (1st AC)"], eq: "ARRI Alexa", shift: "Morning" },
                allowedRoles: ["A-Cam", "B-Cam", "1st AC", "2nd AC", "DIT", "Utility"]
            },
            { 
                id: 2, label: "Field Action",   
                tags: { loc: "Ext. City", ops: ["Marcus Thorne (Action Cam Op)"], eq: "RED Komodo", shift: "Afternoon" },
                allowedRoles: ["Action Cam Op", "Steadicam Op", "1st AC", "Grip", "Utility"]
            },
            { 
                id: 3, label: "Night Drone",    
                tags: { loc: "Rooftop", ops: ["James Miller (Drone Pilot)"], eq: "DJI Inspire", shift: "Night" },
                allowedRoles: ["Drone Pilot", "Gimbal Op", "Visual Observer"]
            },
            { 
                id: 4, label: "Interview B-Cam",
                tags: { loc: "Office 2", ops: ["Sarah Jenkins (Solo Op)"], eq: "Sony FX6", shift: "Morning" },
                allowedRoles: ["Solo Op", "Sound Mixer", "PA"]
            }
        ];

        // State
        let isGlobalRecording = false;
        let isDetailedView = true;
        let isLogoVisible = true;
        let activeSchemaId = null;
        let currentMetadataObj = null; 
        let computerIdCounter = 3;
        let currentTheme = 'dark';
        
        let tempOperators = [];

        let computers = [
            { id: 1, name: "Cam-Rig Alpha", isMounted: true, driveUsage: 95, isRecording: false, errors: ["Drive Full - Cannot record"], metadataObj: null },
            { id: 2, name: "Cam-Rig Beta", isMounted: false, driveUsage: 42, isRecording: false, errors: ["Drive not mounted"], metadataObj: null },
        ];

        // UI State Actions
        function toggleTheme() {
            currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', currentTheme);
            const toggleBtn = document.getElementById('themeToggleBtn');
            toggleBtn.innerText = currentTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

        function toggleLogo() {
            isLogoVisible = !isLogoVisible;
            const logo = document.getElementById('appLogo');
            if (isLogoVisible) {
                logo.classList.remove('hidden');
            } else {
                logo.classList.add('hidden');
            }
        }

        // Core Render Function
        function render() {
            renderSchemas();
            renderComputers();
            populateRosterDropdown();
        }

        function populateRosterDropdown() {
            const select = document.getElementById('rosterSelect');
            if (select.children.length === 0) {
                employeeRoster.forEach(emp => {
                    const opt = document.createElement('option');
                    opt.value = emp;
                    opt.innerText = emp;
                    select.appendChild(opt);
                });
            }
        }

        function populateRoleDropdown() {
            const roleSelect = document.getElementById('roleSelect');
            roleSelect.innerHTML = ''; 
            
            let rolesToUse = defaultRoles;
            if (activeSchemaId) {
                const schema = schemas.find(s => s.id === activeSchemaId);
                if (schema && schema.allowedRoles) {
                    rolesToUse = schema.allowedRoles;
                }
            }
            
            rolesToUse.forEach(role => {
                const opt = document.createElement('option');
                opt.value = role;
                opt.innerText = role;
                roleSelect.appendChild(opt);
            });
        }

        function renderSchemas() {
            const menu = document.getElementById('schemaDropdownMenu');
            menu.innerHTML = '';
            
            const clearItem = document.createElement('div');
            clearItem.className = `dropdown-item ${activeSchemaId === null && currentMetadataObj === null ? 'active' : ''}`;
            clearItem.innerText = "None (Clear Metadata)";
            clearItem.onclick = () => applyPreset(null);
            menu.appendChild(clearItem);

            schemas.forEach(schema => {
                const item = document.createElement('div');
                item.className = `dropdown-item ${activeSchemaId === schema.id ? 'active' : ''}`;
                item.innerText = schema.label;
                item.onclick = () => applyPreset(schema.id);
                menu.appendChild(item);
            });

            const btn = document.getElementById('schemaDropdownBtn');
            if (activeSchemaId) {
                const activeSchema = schemas.find(s => s.id === activeSchemaId);
                btn.innerHTML = `${activeSchema.label} <span>‚ñº</span>`;
                btn.classList.add('has-selection');
            } else if (currentMetadataObj) {
                btn.innerHTML = `Custom Edit Applied <span>‚ñº</span>`;
                btn.classList.add('has-selection');
            } else {
                btn.innerHTML = `Select Preset Schema <span>‚ñº</span>`;
                btn.classList.remove('has-selection');
            }
        }

        function renderComputers() {
            const list = document.getElementById('computerList');
            list.innerHTML = '';

            computers.forEach(comp => {
                const isFull = comp.driveUsage >= 90;
                let statusClass = "status-ready";
                let statusText = "READY";
                
                if (comp.errors.length > 0) {
                    statusClass = "status-error";
                    statusText = "ERROR";
                } else if (comp.isRecording) {
                    statusClass = "status-rec";
                    statusText = "REC";
                }

                // Format Metadata String
                let metaString = "No Schema Applied";
                if (comp.metadataObj) {
                    const opsString = comp.metadataObj.ops && comp.metadataObj.ops.length > 0 
                        ? comp.metadataObj.ops.join(', ') 
                        : "None Selected";

                    metaString = `
                        <strong>Loc:</strong> ${comp.metadataObj.loc} | 
                        <strong>Eq:</strong> ${comp.metadataObj.eq} <br>
                        <strong>Shift:</strong> ${comp.metadataObj.shift} <br>
                        <strong>Ops:</strong> ${opsString}
                    `;
                }

                const card = document.createElement('div');

                if (isDetailedView) {
                    card.className = `computer-card ${comp.errors.length > 0 ? 'has-error' : ''}`;
                    card.innerHTML = `
                        <div class="camera-feed">
                            <div class="status-badge ${statusClass}">${statusText}</div>
                            Live Camera Feed Offline
                        </div>
                        <div class="card-details">
                            <div class="card-header">
                                <div>
                                    <h2>${comp.name}</h2>
                                    <div class="metadata-tags">${metaString}</div>
                                </div>
                            </div>
                            
                            <div class="drive-status">
                                <div class="drive-header">
                                    <span>Drive Storage</span>
                                    <span>${comp.driveUsage}% Used</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill ${isFull ? 'full' : ''}" style="width: ${comp.driveUsage}%"></div>
                                </div>
                            </div>

                            <div class="diagnostics">
                                <strong>Errors Preventing Record:</strong><br>
                                ${comp.errors.join('<br>')}
                            </div>

                            <div class="card-actions">
                                <button class="btn-record-single ${comp.isRecording ? 'is-recording' : ''}" onclick="toggleSingleRecord(${comp.id})" ${comp.errors.length > 0 ? 'disabled' : ''}>
                                    ${comp.isRecording ? '‚èπ Stop Rec' : '‚è∫ Start Rec'}
                                </button>
                                <button class="btn-mount ${comp.isMounted ? 'mounted' : ''}" onclick="toggleMount(${comp.id})">
                                    ${comp.isMounted ? '‚èè Unmount' : '‚¨á Mount'}
                                </button>
                                <button class="btn-erase" onclick="eraseDrive(${comp.id})" ${!comp.isMounted || comp.isRecording ? 'disabled' : ''}>
                                    ‚ö†Ô∏è Erase
                                </button>
                                <button class="btn-remove" onclick="removeComputer(${comp.id})">Remove Rig</button>
                            </div>
                        </div>
                    `;
                } else {
                    card.className = `minimal-card ${comp.errors.length > 0 ? 'has-error' : ''} ${comp.isRecording ? 'is-recording' : ''}`;
                    let innerHTML = `
                        <div class="minimal-main">
                            <div class="minimal-left">
                                <div class="status-badge ${statusClass}">${statusText}</div>
                                <h2>${comp.name}</h2>
                            </div>
                            <div class="minimal-right">
                                <span class="minimal-drive-text">${comp.driveUsage}% Drive</span>
                                <div class="progress-bar">
                                    <div class="progress-fill ${isFull ? 'full' : ''}" style="width: ${comp.driveUsage}%"></div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    if (comp.errors.length > 0) {
                        innerHTML += `
                            <div class="diagnostics minimal-diagnostics">
                                <strong>Alert:</strong> ${comp.errors.join(', ')}
                            </div>
                        `;
                    }
                    card.innerHTML = innerHTML;
                }
                
                list.appendChild(card);
            });

            // Update UI Globals
            const recBtn = document.getElementById('globalRecordBtn');
            const recText = document.getElementById('recordText');
            if (isGlobalRecording) {
                recBtn.classList.add('recording');
                recText.innerText = "STOP ALL";
            } else {
                recBtn.classList.remove('recording');
                recText.innerText = "REC ALL";
            }

            const viewBtn = document.getElementById('viewToggleBtn');
            viewBtn.innerText = isDetailedView ? "üëÄ Minimal View" : "üì∏ Detailed View";
        }

        // Action: Dropdown Logic
        function toggleSchemaDropdown() {
            document.getElementById('schemaDropdownMenu').classList.toggle('active');
        }

        function closeSchemaDropdown() {
            document.getElementById('schemaDropdownMenu').classList.remove('active');
        }

        // Action: Apply Preset Schema
        function applyPreset(id) {
            if (id === null || activeSchemaId === id) {
                activeSchemaId = null;
                currentMetadataObj = null;
                computers.forEach(c => c.metadataObj = null);
            } else {
                activeSchemaId = id;
                const schema = schemas.find(s => s.id === id);
                currentMetadataObj = { ...schema.tags, ops: [...schema.tags.ops] };
                computers.forEach(c => c.metadataObj = { ...currentMetadataObj, ops: [...currentMetadataObj.ops] });
            }
            closeSchemaDropdown();
            render();
        }

        // --- Operator Modal Logic ---
        function openMetadataModal() {
            if (currentMetadataObj) {
                document.getElementById('metaLoc').value = currentMetadataObj.loc;
                document.getElementById('metaEq').value = currentMetadataObj.eq;
                document.getElementById('metaShift').value = currentMetadataObj.shift;
                tempOperators = [...currentMetadataObj.ops];
            } else {
                tempOperators = [];
            }
            
            populateRoleDropdown();
            renderModalOperators();
            document.getElementById('metadataModal').classList.add('active');
        }

        function closeMetadataModal() {
            document.getElementById('metadataModal').classList.remove('active');
        }

        function renderModalOperators() {
            const container = document.getElementById('selectedOperators');
            container.innerHTML = '';
            
            tempOperators.forEach((op, index) => {
                const tag = document.createElement('div');
                tag.className = 'op-tag';
                tag.innerHTML = `${op} <span onclick="removeOperator(${index})">&times;</span>`;
                container.appendChild(tag);
            });
        }

        function addOperator() {
            const select = document.getElementById('rosterSelect');
            const roleSelect = document.getElementById('roleSelect');
            
            const selectedName = select.value;
            const selectedRole = roleSelect.value;
            
            const combinedString = `${selectedName} (${selectedRole})`;
            
            if (selectedName && !tempOperators.includes(combinedString)) {
                tempOperators.push(combinedString);
                renderModalOperators();
            }
        }

        function removeOperator(index) {
            tempOperators.splice(index, 1);
            renderModalOperators();
        }

        function saveCustomMetadata() {
            const customTags = {
                loc: document.getElementById('metaLoc').value,
                ops: [...tempOperators], 
                eq: document.getElementById('metaEq').value,
                shift: document.getElementById('metaShift').value
            };

            currentMetadataObj = customTags;
            activeSchemaId = null; 
            computers.forEach(c => c.metadataObj = { ...currentMetadataObj, ops: [...currentMetadataObj.ops] });
            
            closeMetadataModal();
            render();
        }

        // Action: Add Rig Modal Logic
        function openAddRigModal() {
            document.getElementById('customRigName').value = ''; 
            document.getElementById('addRigModal').classList.add('active');
        }

        function closeAddRigModal() {
            document.getElementById('addRigModal').classList.remove('active');
        }

        function confirmAddRig() {
            const selectValue = document.getElementById('rigSelect').value;
            const customValue = document.getElementById('customRigName').value.trim();
            const finalName = customValue !== '' ? customValue : selectValue;

            computers.push({
                id: ++computerIdCounter,
                name: finalName,
                isMounted: true,
                driveUsage: Math.floor(Math.random() * 80), 
                isRecording: isGlobalRecording,
                errors: [],
                metadataObj: currentMetadataObj ? { ...currentMetadataObj, ops: [...currentMetadataObj.ops] } : null
            });
            
            closeAddRigModal();
            render();
        }

        // Action: View, Mount, Record (Single), Erase, Remove, Record (Global)
        function toggleView() { isDetailedView = !isDetailedView; render(); }
        
        function toggleSingleRecord(id) {
            const comp = computers.find(c => c.id === id);
            if (!comp || comp.errors.length > 0) return;
            comp.isRecording = !comp.isRecording;
            checkGlobalRecordingValidity();
            render();
        }

        function toggleMount(id) {
            const comp = computers.find(c => c.id === id);
            if (comp) {
                comp.isMounted = !comp.isMounted;
                if (!comp.isMounted) {
                    comp.errors = ["Drive not mounted"];
                    comp.isRecording = false; 
                } else {
                    comp.errors = [];
                    if (comp.driveUsage >= 90) comp.errors.push("Drive Full - Cannot record");
                }
            }
            checkGlobalRecordingValidity();
            render();
        }

        function eraseDrive(id) {
            const comp = computers.find(c => c.id === id);
            if (!comp || !comp.isMounted || comp.isRecording) return;
            if (confirm(`‚ö†Ô∏è WARNING ‚ö†Ô∏è\n\nErase Drive on ${comp.name}? \n\nAll data will be permanently deleted.`)) {
                comp.driveUsage = 0; 
                comp.errors = comp.errors.filter(e => e !== "Drive Full - Cannot record");
                render();
            }
        }

        function removeComputer(id) {
            computers = computers.filter(c => c.id !== id);
            checkGlobalRecordingValidity();
            render();
        }

        function toggleGlobalRecord() {
            isGlobalRecording = !isGlobalRecording;
            computers.forEach(comp => {
                if (isGlobalRecording) {
                    if (comp.errors.length === 0) { comp.isRecording = true; }
                } else {
                    comp.isRecording = false;
                }
            });
            render();
        }

        // If ANY rig is recording, flip the global button to STOP ALL
        function checkGlobalRecordingValidity() {
            isGlobalRecording = computers.some(c => c.isRecording);
        }

        // Initial render
        render();
    </script>
</body>
</html>